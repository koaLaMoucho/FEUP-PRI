<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Fetch Solr Documents</title>
</head>

<body>

    <div class="search_bar">
        <h1>One Database</h1>
        <input type="text" id="query-input" placeholder="Enter query (e.g., title:luffy)">
        <button onclick="fetchDocuments()">Fetch Episodes</button>
    </div>
    <div id="episode-list" style="margin-top: 20px; width: 60%;">
        <!-- Episode buttons will be added here -->
    </div>

    <script>
        async function fetchDocuments() {
            const queryInput = document.getElementById('query-input').value.toLowerCase();
            const episodeListContainer = document.getElementById('episode-list');
            episodeListContainer.innerHTML = "Loading...";

            try {
                // Commented server-side fetch for testing purposes
                /*
                const response = await fetch('http://127.0.0.1:5000/fetch_documents', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: queryInput }),
                });
                */

                // Fetch data locally from the JSON file for testing purposes
                const response = await fetch('./testdata.json'); // Load from local file
                if (!response.ok) {
                    throw new Error('Failed to load episode data');
                }

                const data = await response.json();

                // Filter the data based on the query input
                const filteredData = data.filter(episode =>
                    episode.title.toLowerCase().includes(queryInput)
                );

                if (filteredData.length === 0) {
                    episodeListContainer.innerHTML = "<p>No episodes found.</p>";
                    return;
                }

                // Create buttons for each episode
                episodeListContainer.innerHTML = '';
                filteredData.forEach(episode => {
                    const button = document.createElement('button');
                    button.innerHTML = `
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <th style="text-align: left;">
                                    <h3 style="margin: 0;">
                                        <b>${episode.id}</b> - ${episode.title}
                                    </h3>
                                </th>
                                <th style="text-align: right; font-weight: normal;">
                                    ${episode.rating} / 5.0
                                </th>
                            </tr>
                        </table>
                        <br>${episode.short_summary}`; button.style.margin = '5px';
                    button.onclick = () => {
                        window.location.href = `episode.html?id=${encodeURIComponent(episode.id)}`;
                    };
                    episodeListContainer.appendChild(button);
                });
            } catch (error) {
                episodeListContainer.innerHTML = `<p>Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
<footer>
    <div class="footer-container">
        <div class="footer-left"><b>PRI Project</b></div>
        <div class="footer-right"><b>Made by: </b></div>
        <div>Hugo Castro, Marcos Costa, Rodrigo Moucho</div>
    </div>
    </div>
</footer>

</html>