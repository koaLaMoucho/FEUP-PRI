<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Episode Details - Finding One Piece</title>
    <link rel="stylesheet" href="episode-style.css">
</head>

<body>
    <header>
        <div class="header-container">
            <h1>Episode Details</h1>
        </div>
    </header>

    <section id="episode-detail" class="episode-detail">
        <!-- Episode details will be dynamically added here -->
    </section>

    <section id="more-like-this" style="margin-top: 20px;">
        <h2>More like this:</h2>
        <div id="recommendation-buttons" class="recommendation-buttons">
            <!-- Buttons for recommendations will be added here -->
        </div>
    </section>

    <script>
        async function loadEpisodeData() {
            try {
                // Fetch the episode data from testdata.json
                const response = await fetch('./testdata.json');
                if (!response.ok) {
                    throw new Error('Failed to load episode data');
                }

                const episodes = await response.json();
                const urlParams = new URLSearchParams(window.location.search);
                const episodeId = urlParams.get('id');

                // Find the current episode by ID
                const episode = episodes.find(ep => ep.id === episodeId);
                if (!episode) {
                    document.getElementById('episode-detail').innerHTML = '<p>Episode not found.</p>';
                    return;
                }

                // Render episode details
                const episodeDetailContainer = document.getElementById('episode-detail');
                const validFruits = episode.fruits.filter(fruit => fruit.trim() !== ''); // Filter out empty strings

                episodeDetailContainer.innerHTML = `
                    <h2>${episode.title}</h2>
                    <div class="wiki-section">
                        <p><strong>Air Date:</strong></p>
                        <p>${episode.air_date}</p>
                    </div>
                    <div class="wiki-section">
                        <p><strong>Rating:</strong></p>
                        <p>${episode.rating}</p>
                    </div>
                    <div class="wiki-section">
                        <p><strong>Short Summary:</strong></p>
                        <p>${episode.short_summary}</p>
                    </div>
                    <div class="wiki-section">
                        <p><strong>Long Summary:</strong></p>
                        <p>${episode.long_summary}</p>
                    </div>
                    <div class="wiki-section">
                        <p><strong>Characters:</strong></p>
                        <ul>
                            ${episode.characters.map(character => `<li>${character}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="wiki-section">
                        <p><strong>Fruits:</strong></p>
                        <ul>
                            ${validFruits.length > 0
                                ? validFruits.map(fruit => `<li>${fruit}</li>`).join('')
                                : `<li class="no-fruits">This episode featured no Devil Fruits.</li>`}
                        </ul>
                    </div>
                `;

                // Render "More like this" section
                const otherEpisodes = episodes.filter(ep => ep.id !== episodeId); // Exclude current episode
                const recommendations = otherEpisodes.slice(0, 3); // Select up to 3 other episodes

                const recommendationContainer = document.getElementById('recommendation-buttons');
                recommendations.forEach(episode => {
                    const button = document.createElement('button');
                    button.innerHTML = `<h3 style="margin: 0;">
                                            <b>${episode.id}</b> - ${episode.title}
                                        </h3>
                                        <br>${episode.short_summary}`;
                    button.style.margin = '5px';
                    button.onclick = () => {
                        window.location.href = `episode.html?id=${encodeURIComponent(episode.id)}`;
                    };
                    recommendationContainer.appendChild(button);
                });
            } catch (error) {
                document.getElementById('episode-detail').innerHTML = `<p>Error: ${error.message}</p>`;
            }
        }

        // Load episode data when the page loads
        loadEpisodeData();
    </script>
</body>

</html>